services:
  mongo:
    build: ./mongo
    container_name: mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    networks:
      - backend

  fastapi:
    build: ./fastapi_app
    container_name: fastapi
    depends_on:
      - mongo
    environment:
      MONGO_URI: mongodb://root:example@mongo:27017
    ports:
      - "8000:8000"
    networks:
      - backend

  scraper:
    build: ./scraper
    container_name: scraper
    depends_on:
      - fastapi
    environment:
      API_URL: http://fastapi:8000
    ports:
      - "8080:8080"
    volumes:
      - ./extracted_data:/app/extracted_data
      - ./data:/app/data
    tmpfs:
      # RAM disk for temporary file storage (avoid disk I/O bottleneck)
      # Size: 512MB - adjust based on available RAM and workload
      - /tmp_ram_scraper:size=512M,mode=1777
    networks:
      - backend
    # Increase shared memory for multiprocessing
    shm_size: '256m'

networks:
  backend:

volumes:
  mongo_data: